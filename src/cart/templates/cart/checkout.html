<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{% static 'cart/css/cart.css' %}"> -->
    <title>cart</title>

    <!-- If this same script in store.html has been moved to base.html, this one will be deleted -->
    <script type="text/javascript">
        let user = '{{request.user}}'

        function getToken(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        let csrftoken = getToken('csrftoken');

        function getCookie(name) {
		    // Split cookie string and get all individual name=value pairs in an array
		    var cookieArr = document.cookie.split(";");

		    // Loop through the array elements
		    for(let i = 0; i < cookieArr.length; i++) {
		        let cookiePair = cookieArr[i].split("=");

		        /* Removing whitespace at the beginning of the cookie name
		        and compare it with the given string */
		        if(name == cookiePair[0].trim()) {
		            // Decode the cookie value and return
		            return decodeURIComponent(cookiePair[1]);
		        }
		    }

		    // Return null if not found
		    return null;
		}
		let cart = JSON.parse(getCookie('cart'))

		if (cart == undefined){
			cart = {}
			console.log('Cart Created!', cart)
			document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"
		}
		console.log('Cart:', cart)

    </script>
</head>
<body>

    {% for item in items %}
        <p>{{item.product.name_of_product}}</p>
        <p>{{item.product.price}}</p>
        <p>{{item.quantity}}</p>
        <img src="{{item.product.image_url}}" alt="">
        
    {% endfor %}

    <br><br>
    <p>Cart count: {{cart_count}}</p>
    <p>Items: {{order.get_order_items}}</p>
    <p>Total: {{order.get_order_total}}</p>


    <form method="POST" id="form">
        {% csrf_token %}
        <div>
            <input required type="text" name="name" placeholder="Name">
            <input required type="email" name="email" placeholder="Email Address">
        </div>
        
        <div>
            <input required type="text" name="adress" placeholder="address">
            <input required type="text" name="city" placeholder="City">
            <input required type="text" name="state" placeholder="State">
            <input required type="text" name="country" placeholder="Country">
            <button type="submit" id="submit-button">Submit</button>
        </div>
        
    </form>


        <!-- To be added to base.html file when created -->
    <script type="text/javascript" src="{% static 'cart/js/cart.js' %}"></script>

    <script type="text/javascript">
        document.getElementById('form').addEventListener('submit', function(e){
            e.preventDefault()
            submitForm()
        })

        function submitForm(){
            console.log('form submitted')
        }
    </script>
    
</body>
</html>
<body>